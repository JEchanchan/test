<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:jee="http://www.springframework.org/schema/jee" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:tx="http://www.springframework.org/schema/tx" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="
    http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-3.0.xsd
	http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd
    http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.2.xsd        
    http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.2.xsd
    http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-3.0.xsd">

	<!-- 注解扫描包 -->
	<context:component-scan base-package="com.yunlu.dao" />


	<bean id="slaveDataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName" value="java:comp/env/jdbc/Slave" />
	</bean>
	
	<bean id="slaveSessionFactory"
		class="org.springframework.orm.hibernate4.LocalSessionFactoryBean">
		<property name="dataSource">
			<ref local="slaveDataSource" />
		</property>
		<property name="mappingResources">
			<list>
				<value>com\yunlu\model\Notice.hbm.xml</value>	<!-- 课程通知 -->
				<value>com\yunlu\model\ScoreSettings.hbm.xml</value>	<!-- 分数设置 -->
				<value>com\yunlu\model\WebsiteSettings.hbm.xml</value>	<!-- 网站配置 -->
				<value>com\yunlu\model\Course.hbm.xml</value>	<!-- 课程 -->
				<value>com\yunlu\model\CourseInfo.hbm.xml</value> 	<!-- 课程详细信息 -->
				<value>com\yunlu\model\Team.hbm.xml</value>	<!-- 课程团队 -->
				<value>com\yunlu\model\Chapter.hbm.xml</value>	<!-- 课程章 -->
				<value>com\yunlu\model\Section.hbm.xml</value>	<!-- 课程节 -->
				<value>com\yunlu\model\ComponentDraft.hbm.xml</value>	<!-- 小节组件草稿 -->
				<value>com\yunlu\model\Component.hbm.xml</value>	<!-- 小节组件 -->
				<value>com\yunlu\model\CrsFile.hbm.xml</value>	<!-- 课程文件 -->
				
				<value>com\yunlu\model\Answer.hbm.xml</value>	<!-- 课程习题组件答题 -->
				<value>com\yunlu\model\LearnProgress.hbm.xml</value>	<!-- 学习进度 -->
				<value>com\yunlu\model\Dict.hbm.xml</value>	<!-- 字典 -->
				<value>com\yunlu\model\School.hbm.xml</value>	<!-- 学校 -->
				<value>com\yunlu\model\UsrCourse.hbm.xml</value>	<!-- 用户课程关联  -->
				<value>com\yunlu\model\YAuthOrg.hbm.xml</value>
				<value>com\yunlu\model\YCrsHot.hbm.xml</value>
				<value>com\yunlu\model\YDicQuality.hbm.xml</value>
				<value>com\yunlu\model\YDicTchTitle.hbm.xml</value>
				<value>com\yunlu\model\YInvitationCode.hbm.xml</value>
				<value>com\yunlu\model\YKnoCourse.hbm.xml</value>
				<value>com\yunlu\model\YKnoSkill.hbm.xml</value>
				<value>com\yunlu\model\YKnoSkiTest.hbm.xml</value>
				<value>com\yunlu\model\YKnowledge.hbm.xml</value>
				<value>com\yunlu\model\YSchMajor.hbm.xml</value>
				<value>com\yunlu\model\YUsrEducation.hbm.xml</value>
				<value>com\yunlu\model\YUsrKnoSkill.hbm.xml</value>
				<value>com\yunlu\model\YUsrQuality.hbm.xml</value>
				<value>com\yunlu\model\YUsrResCompany.hbm.xml</value>
				<value>com\yunlu\model\YUsrResComProject.hbm.xml</value>
				<value>com\yunlu\model\YUsrResEduExperience.hbm.xml</value>
				<value>com\yunlu\model\YUsrResEduHonor.hbm.xml</value>
				<value>com\yunlu\model\YUsrResume.hbm.xml</value>
				<value>com\yunlu\model\YCorJob.hbm.xml</value>
				<value>com\yunlu\model\YCorJobReqInvitation.hbm.xml</value>
				<value>com\yunlu\model\YCorJobRequest.hbm.xml</value>
				<value>com\yunlu\model\YCorJobSkillRequirement.hbm.xml</value>
				<value>com\yunlu\model\YCorporation.hbm.xml</value>
				
				<value>com\yunlu\model\YMenu.hbm.xml</value><!-- 权限菜单  -->
				<value>com\yunlu\model\YRole.hbm.xml</value><!-- 用户角色  -->
				<value>com\yunlu\model\YRoleMenu.hbm.xml</value><!-- 角色菜单关联  -->	
				<value>com\yunlu\model\YUser.hbm.xml</value><!-- 用户  -->
				<value>com\yunlu\model\YUserRole.hbm.xml</value><!-- 用户角色关联  -->
				<value>com\yunlu\model\UserProfile.hbm.xml</value><!-- 用户详细资料  -->		
				<value>com\yunlu\model\YGetPassword.hbm.xml</value><!-- 用户获取密码  -->	
				<value>com\yunlu\model\YAuthEmail.hbm.xml</value><!-- email鉴权  -->	
				
				<!-- 云高校 -->
				<value>com\yunlu\model\YCrsSchBacklist.hbm.xml</value>
				<value>com\yunlu\model\YCrsTask.hbm.xml</value>
				<value>com\yunlu\model\YCrsClass.hbm.xml</value>
				<value>com\yunlu\model\YCrsTopic.hbm.xml</value>
				<value>com\yunlu\model\YCrsTpcPost.hbm.xml</value>
				<value>com\yunlu\model\YDicCrsShieldType.hbm.xml</value>
				<value>com\yunlu\model\YSchClass.hbm.xml</value>
				<value>com\yunlu\model\YSchDepartment.hbm.xml</value>
				<value>com\yunlu\model\YSchStudent.hbm.xml</value>
				<value>com\yunlu\model\YSchTeacher.hbm.xml</value>
				<value>com\yunlu\model\YStuTask.hbm.xml</value>
				<value>com\yunlu\model\Domain.hbm.xml</value>
				<value>com\yunlu\model\UsrVerify.hbm.xml</value>
				
				<!-- 高校首页可配置添加的表 -->
				
				<value>com\yunlu\model\SchoolProfile.hbm.xml</value>
				<value>com\yunlu\model\SchHomepageModule.hbm.xml</value>
				<value>com\yunlu\model\FocusImg.hbm.xml</value>
				
				<!-- 智能测试  -->
				
				<value>com\yunlu\model\YKnoLevel.hbm.xml</value>
				<value>com\yunlu\model\YLevelSkill.hbm.xml</value>
				<value>com\yunlu\model\YQuestion.hbm.xml</value>
				<value>com\yunlu\model\YSkillCrs.hbm.xml</value>
				<value>com\yunlu\model\YSkillQuestion.hbm.xml</value>
				<value>com\yunlu\model\YUserTestRecord.hbm.xml</value>
				<value>com\yunlu\model\YUserTestResult.hbm.xml</value>
			</list>
		</property>
		<property name="hibernateProperties">
			<props>
				<prop key="hibernate.format_sql">true</prop>
				<prop key="hibernate.dialect">org.hibernate.dialect.MySQL5InnoDBDialect</prop>
				<!-- <prop key="hibernate.hbm2ddl.auto">update</prop> -->
				<prop key="hibernate.show_sql">true</prop>
				<prop key="current_session_context_class">thread</prop>
				<!-- <prop key="connection.pool_size">3</prop> -->
				<prop key="javax.persistence.validation.mode">none</prop>
				<prop key="hibernate.current_session_context_class">org.springframework.orm.hibernate4.SpringSessionContext
				</prop>
				<prop key="hibernate.default_catalog">yunlu_new</prop>
			</props>
		</property>
	</bean>

	<bean id="slaveTxManager" class="org.springframework.orm.hibernate4.HibernateTransactionManager">
		<property name="sessionFactory" ref="slaveSessionFactory" />
	</bean>

	<tx:advice id="slaveTxAdvice" transaction-manager="slaveTxManager">
		<tx:attributes>
			<tx:method name="*" propagation="REQUIRED" rollback-for="Exception" />
		</tx:attributes>
	</tx:advice>

	<aop:config expose-proxy="true">
		<aop:pointcut id="txPointcut" expression="execution(* com.yunlu.*.service.*Service.*(..))" />
		<aop:advisor advice-ref="slaveTxAdvice" pointcut-ref="txPointcut" />
	</aop:config>

</beans>